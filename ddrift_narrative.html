
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Data Drift &#8212; MLOPs Primer</title>
    
  <link href="_static/css/theme.css" rel="stylesheet">
  <link href="_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="_static/sphinx-book-theme.d59cb220de22ca1c485ebbdc042f0030.js"></script>
    <script async="async" src="https://unpkg.com/thebe@0.5.1/lib/index.js"></script>
    <script>
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Concept Drift" href="cdrift_narrative.html" />
    <link rel="prev" title="Three Months Later…" href="retrain_narrative.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="_static/aml_logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">MLOPs Primer</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="intro.html">
   Welcome
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Pre-Production
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="business_problem.html">
   The Business Scenario
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="dataset.html">
   The Dataset
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="exploratory_analysis.html">
   Exploratory Data Analysis
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="train_model.html">
   Model Training
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="deploy_model.html">
   Model Deployment
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Post-Production
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="retrain_narrative.html">
   Three Months Later…
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Data Drift
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="cdrift_narrative.html">
   Concept Drift
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="black_swan.html">
   Black Swan
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Other
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="economics.html">
   Solution Costs
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="year_in_review.html">
   A Year in Review
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="install.html">
   Next Steps
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="_sources/ddrift_narrative.md"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.md</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
                onclick="printPdf(this)" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show noprint">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#necessary-steps">
   Necessary Steps
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#data-drift-monitor">
   Data Drift Monitor
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#viewing-data-drift-results">
     Viewing Data Drift Results
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#alerting">
     Alerting
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#comparing-the-baseline-model">
   Comparing the Baseline Model
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#background-context">
   Background Context
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Data Drift</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#necessary-steps">
   Necessary Steps
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#data-drift-monitor">
   Data Drift Monitor
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#viewing-data-drift-results">
     Viewing Data Drift Results
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#alerting">
     Alerting
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#comparing-the-baseline-model">
   Comparing the Baseline Model
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#background-context">
   Background Context
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            
              <div>
                
  <div class="tex2jax_ignore mathjax_ignore section" id="data-drift">
<h1>Data Drift<a class="headerlink" href="#data-drift" title="Permalink to this headline">¶</a></h1>
<p>As a few more months pass, the MLOps team start to notice the retrained model’s accuracy regress.</p>
<p>On further inspection, they notice that some of the key attributes (including <code class="docutils literal notranslate"><span class="pre">Contract</span></code>, <code class="docutils literal notranslate"><span class="pre">tenure_bins</span></code>, etc.)
are starting to have different distributions. For example, in the <code class="docutils literal notranslate"><span class="pre">Contract</span></code> attribute, <em>Month-to-Month</em>
contracts were almost ~55% of the customer contract preference. However, this is becoming more of an even
spread across month-to-month, 1-year and 2-year contracts. Given the recent pandemic with more people working
from home, the business speculates that more customers are willing to commit to a longer-term plan to lock in
more predictable rates. Telecom providers are also focusing more efforts on expanding services through
internet services, and are making available better deals on longer-term contracts, with fewer switching
incentives.</p>
<p>As the business continues to learn more, the MLOps team has a more immediate concern. The existing model needs
to reflect these new behaviorial shifts. Attributes like the <code class="docutils literal notranslate"><span class="pre">Contract</span></code> attribute were also one of the primary
features in the baseline/retrained model hence sharper deviations on this attribute may cause changes
in the current model’s assumptions.</p>
<p>This is an example of <strong>data drift</strong> - when the original distributions of the attributes used to train the
model start to shift.</p>
<p>In practice, there are a number of methods to detect data drift on input features. As shown later, the Data
Drift Monitor feature in Azure ML helps identify variances in statistics like mean, median, skewness,
kurtosis, etc. in both baseline and target distributions. A more advanced approach may be to employ a
two-sample test like the <em>Kolmogorov-Smirnov test (KS test)</em>. This can detect statistical significance
between two distinct populations (in this case, the <code class="docutils literal notranslate"><span class="pre">Transformed</span> <span class="pre">Training</span> <span class="pre">Baseline</span> <span class="pre">Dataset</span></code> and the <code class="docutils literal notranslate"><span class="pre">Data</span> <span class="pre">Drift</span> <span class="pre">Dataset</span></code>). Other tests include the <em>Least-Squares Density Difference</em> or the <em>Maximum Mean Discrepancy</em>
technique. None of the tests are without issues. For example, the KS Test can only be used for
one-dimensional data, and so will be limited for highly dimensional data (i.e. most features). While expanding
on the pros and cons of each approach is beyond the scope, do note that a combination of these methods as necessary
for the business use case is recommended.</p>
<p>To respond to data drifts, there are a number of approaches a business can take. Most cases require
retraining. But there are interesting considerations posed on how much of the old and the new dataset to
include. It could be the case that as time passes and the business responds to some of the factors that cause
customers to churn, a newer dataset would reflect more of the current reality. In other words, the causes of
churn today are different than they were before. In other cases, a larger dataset may be more advisable to
account for new and recurring behaviors. To simplify the illustration, we will assume that the new batch
offers the most current reality and will be the basis for a new model (i.e. no older data).</p>
<p>Other considerations to note in responding to data drift include:</p>
<ul class="simple">
<li><p><strong>Model degradation.</strong> There may be an acceptable level of degradation implicit in the model that the
business is willing to assume before retraining. In some industies, the tolerance for drift may be extremely
low, particularly when a point of drift translates into catastrophic or serious consequences (e.g.
mis-diagnosis of a terminal illness). As mentioned before, establishing degradation is also a factor of how
soon the business can establish ground truth.</p></li>
<li><p><strong>Automation vs. manual intervention.</strong> In general, automation should be strongly encouraged to reinforce
DevOps practices as a foundation for MLOps. In MLOps, this can often take the example of automatically
triggering a retrain when model performance drops below a certain threshold. With new data to account for,
and other variables reasonably consistent (e.g. same algorithm, same objective/use case), this is a
reasonable and recommended approach. In other cases, there may be a need to take more manual calls before
pushing a new model to production. Retraining of a model may greatly simplify getting a new model to
production, but if it is not properly understood why certain drifts occur, it is worth slowing the process
down to better understand this.</p></li>
</ul>
<div class="section" id="necessary-steps">
<h2>Necessary Steps<a class="headerlink" href="#necessary-steps" title="Permalink to this headline">¶</a></h2>
<ol class="simple">
<li><p><strong>Artifact the new batch of data.</strong> The new batch of data (the <code class="docutils literal notranslate"><span class="pre">Data</span> <span class="pre">Drift</span> <span class="pre">Dataset</span></code>) needs to be registered
in the workspace. This helps with data lineage and reproducability of results. This dataset contains the
same attributes, and relative relationship of churn as the <code class="docutils literal notranslate"><span class="pre">Transformed</span> <span class="pre">Training</span> <span class="pre">Baseline</span> <span class="pre">Dataset</span></code>.
However, as noted above,  a number of attributes are starting to show changes in their spread. More context
on how this was created is in the <em>Background Context</em> section below.</p></li>
<li><p><strong>Train the model.</strong> Off the <code class="docutils literal notranslate"><span class="pre">Data</span> <span class="pre">Drift</span> <span class="pre">Dataset</span></code>, a new training run with AutoML can be triggered to find
the best model. The AutoML configuration is similar to the retraining step the few months before.</p>
<ul class="simple">
<li><p>Results of the training process yield the following results:
<img alt="datadrift_models" src="_images/ddrift_models.jpg" /></p></li>
<li><p>After re-training, a number of other features and their importance have rejiggered from their
original baseline positions. <img alt="ddrift_exp_features" src="_images/ddrift_exp_features.jpg" /></p></li>
<li><p>Test accuracy is slightly better at ~84% vs. ~82%…
<img alt="ddrift_test_accuracy" src="_images/ddrift_test_accuracy.jpg" /></p></li>
</ul>
</li>
</ol>
</div>
<div class="section" id="data-drift-monitor">
<h2>Data Drift Monitor<a class="headerlink" href="#data-drift-monitor" title="Permalink to this headline">¶</a></h2>
<p>One of the ways to keep track of some of these shifts is to periodically run a <strong>dataset monitor</strong> which
specifically compares datasets over time and between different time periods. Setting this up requires some
configuration on the datasets to compare. In this case, both the baseline and the new batch of the <code class="docutils literal notranslate"><span class="pre">Data</span> <span class="pre">Drift</span> <span class="pre">Dataset</span></code> are discretely added for comparison, with appropriate timestamps. <img alt="data_drift_datasets" src="_images/data_drift_datasets.jpg" /></p>
<div class="section" id="viewing-data-drift-results">
<h3>Viewing Data Drift Results<a class="headerlink" href="#viewing-data-drift-results" title="Permalink to this headline">¶</a></h3>
<p>The studio experience allows an overview of a composite metric for data drift, some level of exploration
of which attributes are driving the data drift, and how they contribute. More customization is possible given
the tight integration with App Insights and Azure Monitor to define reporting and thresholds at even granular
levels.</p>
<p>For a quick overview of the out-of-box view, see the video below:
<img alt="data_drift_monitor" src="_images/data_drift_monitor.gif" /></p>
</div>
<div class="section" id="alerting">
<h3>Alerting<a class="headerlink" href="#alerting" title="Permalink to this headline">¶</a></h3>
<p>One of the benefits of setting up a data drift monitor is its tight integration with Azure Monitor, along with
its alerting capabilities to identify when drift has exceeded a certain threshold.</p>
<p>For example, this is the email notification one receives when a data drift alert is detected.
<img alt="data_drift_alert" src="_images/data_drift_alert.jpg" /></p>
<p>And this is the email notification which can help define the specific users/group to be part of to be notified
when there is drift detected.
<img alt="data_drift_action_group" src="_images/data_drift_action_group.jpg" /></p>
<p>Such alerting mechanisms enable the MLOps team to be proactive with how their data is changing and respond
accordingly. Note that not all data drifts are inherently data relationships changing. Often, there can be
some quality gaps in the attributes coming through the system, and this can be a early signal to mitigate
system issues.</p>
</div>
</div>
<div class="section" id="comparing-the-baseline-model">
<h2>Comparing the Baseline Model<a class="headerlink" href="#comparing-the-baseline-model" title="Permalink to this headline">¶</a></h2>
<p>To see how much the new dataset has degraded on the baseline model, we can compare the <code class="docutils literal notranslate"><span class="pre">Data</span> <span class="pre">Drift</span> <span class="pre">Dataset</span></code> on
the original <code class="docutils literal notranslate"><span class="pre">baseline-model-endpoint</span></code>. This yields an error rate of +23.6%, compared to the baseline error
rate of ~19-20%. Hence, the inherent drift in the data distributions is leading to this increased
inaccuracy for predictions.</p>
<p><img alt="data_drift_comparison" src="_images/compare_data_drift.gif" /></p>
</div>
<div class="section" id="background-context">
<h2>Background Context<a class="headerlink" href="#background-context" title="Permalink to this headline">¶</a></h2>
<p>To simulate this scenario, a simulated dataset was created adjusting for a more consistent spread across the
<code class="docutils literal notranslate"><span class="pre">Contract</span></code>, <code class="docutils literal notranslate"><span class="pre">PaymentMethod</span></code>, <code class="docutils literal notranslate"><span class="pre">Dependents</span></code>, <code class="docutils literal notranslate"><span class="pre">OnlineSecurity</span></code>, <code class="docutils literal notranslate"><span class="pre">TechSupport</span></code> and <code class="docutils literal notranslate"><span class="pre">tenure_bins</span></code> attribute in the
baseline dataset. All else was maintained in terms of attribute distributions and overall churn rate compared
to the baseline dataset. More details are in the <code class="docutils literal notranslate"><span class="pre">modeling</span></code> folder of the repo.</p>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            
                <!-- Previous / next buttons -->
<div class='prev-next-area'> 
    <a class='left-prev' id="prev-link" href="retrain_narrative.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Three Months Later…</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="cdrift_narrative.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Concept Drift</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            
        </div>
    </div>
    <footer class="footer">
  <p>
    
      By The Jupyter Book community<br/>
    
        &copy; Copyright 2021.<br/>
  </p>
</footer>
</main>


      </div>
    </div>
  
  <script src="_static/js/index.be7d3bbb2ef33a8344ce.js"></script>

  </body>
</html>